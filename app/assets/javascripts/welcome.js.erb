
$(document).ready(function () {
  var digest_bitmap = function () {

    var actors = "\
nnnnnnnnnnnnnnnn\
nnnnnnnnnnnnnnnn\
nnnn........nnnn\
nnnnn..r...nnnnn\
nnnnnn.......nnn\
nnnnn.....nnnnnn\
nnnnnnnnnnnnnnnn\
nnnnnnnnnnnnnnnn\
"
    var sprites = [];

    for(var i = 0; i < actors.length; i++) {
      var symbol = actors[i],
          klass = Q.legend[symbol],
          x = 90 * (i % 16),
          y = 90 * parseInt(i / 16, 10);

      sprites[i] = new klass({ x: x + 45, y: y + 45 });
    }

    return sprites;
  };

  console.log("GO");

  var Q = Quintus({ imagePath: "/assets/"})
            .include("Sprites, Scenes, 2D, Input")
            .setup({
              height: 720,
              width: 1440
            }).controls();

  Q.Sprite.extend("Blank", {
    init: function(p) {
      p.sheet = "signal";
      p.frame = 27;
      this._super(p);
    }
  });

  Q.Sprite.extend("Drone", {
    init: function(p) {
      p.sheet = "signal";
      p.stepDistance = 90;
      this._super(p);
    }
  });

  Q.Drone.extend("Null", {
    init: function (p) {
      p.frame = 20;
      this._super(p);
    },
  });

  Q.Drone.extend("RedDrone", {
    init: function (p) {
      p.frame = 21;
      this._super(p);

      this.add("stepControls");
    }

  });

  Q.legend = {
    '.': Q.Blank,
    'n': Q.Null,
    'r': Q.RedDrone
  };

  Q.load([ "signal_tiles.png"], function() {
    Q.sheet("signal", "signal_tiles.png", { tilew: 90, tileh: 90, sx:0, sy:0 });

    var actors = digest_bitmap();

    Q.gameLoop(function (dt) {
      var i;

      for(i = 0; i < actors.length; i++) {
        actors[i].update(dt);
      }

      Q.clear();

      for(i = 0; i < actors.length; i++) {
        actors[i].render(Q.ctx);
      }
    });
  });

  console.log("STOP");

});
